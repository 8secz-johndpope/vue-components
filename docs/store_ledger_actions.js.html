<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: store/ledger/actions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: store/ledger/actions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import TransportWebUSB from '@ledgerhq/hw-transport-webusb';
import TransportU2F from '@ledgerhq/hw-transport-u2f';
import CosmosApp from 'ledger-cosmos-js';

import {
  createCosmosAddress, createIrisAddress, createTerraAddress, createKavaAddress,
} from '../../helpers/wallet';
import {
  enrichIrisAccount, enrichKavaAccount, enrichTerraAccount,
} from '../../helpers/accountEnrichment';
// import {
//   fetchCosmosAccountAuthInfo,
// } from '../../services/api';


/**
 * @function connectLedger
 * @description initiates a connection to a Ledger device, saves connection to the state,
 * @description and queries device information which is also saved to the state
 */
export const connectLedger = async ({ state, commit, dispatch }) => {
  try {
    commit('session/SET_LOADING', { ledger: true }, { root: true });

    let transport = null;
    if (state.transportChoice === 'WebUSB') {
      transport = await TransportWebUSB.create();
    } else {
      transport = await TransportU2F.create(10000);
    }

    const ledgerApp = new CosmosApp(transport);
    commit('SET_APP', ledgerApp);

    const response = await ledgerApp.getVersion();
    if (response.error_message !== 'No errors') {
      dispatch('session/logError', response.error_message, { root: true });
    } else {
      commit('SET_LEDGER_APP_INFO', response);
    }
  } catch (error) {
    dispatch('session/logError', error, { root: true });
  } finally {
    commit('session/SET_DONE_LOADING', { ledger: false }, { root: true });
  }
};


export const viewLedgerAddress = async ({ commit, dispatch, state }) => {
  try {
    let transport = null;
    if (state.transportChoice === 'WebUSB') {
      transport = await TransportWebUSB.create();
    } else {
      transport = await TransportU2F.create(10000);
    }

    const app = new CosmosApp(transport);

    // parse Ledger account for the first HDPATH
    const pubKey = await app.publicKey(state.HDPATH);

    const irisAddress = createIrisAddress(pubKey.compressed_pk);
    const cosmosAddress = createCosmosAddress(pubKey.compressed_pk);
    const kavaAddress = createKavaAddress(pubKey.compressed_pk);
    const terraAddress = createTerraAddress(pubKey.compressed_pk);

    // Commit the enrichedAccounts to state
    commit('SET_IRIS_ADDRESS', irisAddress);
    commit('SET_COSMOS_ADDRESS', cosmosAddress);
    commit('SET_KAVA_ADDRESS', kavaAddress);
    commit('SET_TERRA_ADDRESS', terraAddress);
  } catch (e) {
    dispatch('session/logError', e, { root: true });
  }
};

export const getLedgerAccountDetails = async ({
  commit, dispatch, state,
}) => {
  try {
    dispatch('session/logInfo', 'getLedgerAccountDetails', { root: true });

    commit('session/SET_LOADING', { ledger: true }, { root: true });

    let transport = null;
    if (state.transportChoice === 'WebUSB') {
      transport = await TransportWebUSB.create();
    } else {
      transport = await TransportU2F.create(10000);
    }

    // create new CosmosApp Instance using ledger-cosmos-js
    const app = new CosmosApp(transport);
    const pubKey = await app.publicKey(state.HDPATH);

    const irisAddress = createIrisAddress(pubKey.compressed_pk);
    const cosmosAddress = createCosmosAddress(pubKey.compressed_pk);
    const kavaAddress = createKavaAddress(pubKey.compressed_pk);
    const terraAddress = createTerraAddress(pubKey.compressed_pk);
    commit('SET_IRIS_ADDRESS', irisAddress);
    commit('SET_COSMOS_ADDRESS', cosmosAddress);
    commit('SET_KAVA_ADDRESS', kavaAddress);
    commit('SET_TERRA_ADDRESS', terraAddress);

    const account = {
      HDPATH: state.HDPATH,
      pubKey,
    };
    // console.log(account);


    // console.log('fetching enriched accounts');

    // const enrichedCosmosAccount = await enrichCosmosAccount(account);
    // console.log(enrichedCosmosAccount);

    const enrichedTerraAccount = await enrichTerraAccount(account);
    // console.log(enrichedTerraAccount);

    const enrichedKavaAccount = await enrichKavaAccount(account);
    // console.log(enrichedKavaAccount);

    const enrichedIrisAccount = await enrichIrisAccount(account);
    // console.log(enrichedIrisAccount);

    commit('SET_IRIS_ACCOUNT', enrichedIrisAccount);
    // commit('SET_COSMOS_ACCOUNT', enrichedCosmosAccount);
    commit('SET_KAVA_ACCOUNT', enrichedKavaAccount);
    commit('SET_TERRA_ACCOUNT', enrichedTerraAccount);
    // let enrichedAccount;
    // console.log(rootState.session.networkConstants);
    // if (rootState.session.networkConstants === 'cosmos') {
    //   // enrichedAccount = await enrichCosmosAccount(account);
    // } else if (rootState.session.networkConstants === 'iris') {
    //   enrichedAccount = await enrichIrisAccount(account);
    // }
    // console.log(enrichedAccount);

    // Commit the enrichedAccount to state
    // commit('SET_ACCOUNT', userAccount);
    commit('session/SET_DONE_LOADING', { ledger: false }, { root: true });
  } catch (e) {
    throw new Error(e);
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#beginDelegation">beginDelegation</a></li><li><a href="global.html#beginIrisDelegation">beginIrisDelegation</a></li><li><a href="global.html#beginRedelegation">beginRedelegation</a></li><li><a href="global.html#beginUnbonding">beginUnbonding</a></li><li><a href="global.html#beginVoteTransaction">beginVoteTransaction</a></li><li><a href="global.html#buildSignSendCosmosTx">buildSignSendCosmosTx</a></li><li><a href="global.html#buildSignSendKavaTx">buildSignSendKavaTx</a></li><li><a href="global.html#checkIrisTxStatus">checkIrisTxStatus</a></li><li><a href="global.html#connectLedger">connectLedger</a></li><li><a href="global.html#endVoteTransaction">endVoteTransaction</a></li><li><a href="global.html#enrichCosmosAddresses">enrichCosmosAddresses</a></li><li><a href="global.html#enrichIrisAddresses">enrichIrisAddresses</a></li><li><a href="global.html#enrichKavaAddresses">enrichKavaAddresses</a></li><li><a href="global.html#enrichTerraAddresses">enrichTerraAddresses</a></li><li><a href="global.html#errorMessage">errorMessage</a></li><li><a href="global.html#fetchCosmosAccountAuthInfo">fetchCosmosAccountAuthInfo</a></li><li><a href="global.html#fetchCosmosAccountBalance">fetchCosmosAccountBalance</a></li><li><a href="global.html#fetchCosmosAddressDelegations">fetchCosmosAddressDelegations</a></li><li><a href="global.html#fetchCosmosAddressDelegationTxHistory">fetchCosmosAddressDelegationTxHistory</a></li><li><a href="global.html#fetchCosmosAddressUnbondingDelegations">fetchCosmosAddressUnbondingDelegations</a></li><li><a href="global.html#fetchCosmosDelegateValidatorRewards">fetchCosmosDelegateValidatorRewards</a></li><li><a href="global.html#fetchCosmosDelegationRewards">fetchCosmosDelegationRewards</a></li><li><a href="global.html#fetchCosmosDelegationUnbondingTxs">fetchCosmosDelegationUnbondingTxs</a></li><li><a href="global.html#fetchCosmosGovernanceProposals">fetchCosmosGovernanceProposals</a></li><li><a href="global.html#fetchCosmosGovProposalVotesByProposalId">fetchCosmosGovProposalVotesByProposalId</a></li><li><a href="global.html#fetchCosmosLatestBlock">fetchCosmosLatestBlock</a></li><li><a href="global.html#fetchCosmosStakingParameters">fetchCosmosStakingParameters</a></li><li><a href="global.html#fetchCosmosTxByHash">fetchCosmosTxByHash</a></li><li><a href="global.html#fetchCosmosValidatorSet">fetchCosmosValidatorSet</a></li><li><a href="global.html#fetchGovernanceProposals">fetchGovernanceProposals</a></li><li><a href="global.html#fetchIrisAccountAuthInfo">fetchIrisAccountAuthInfo</a></li><li><a href="global.html#fetchIrisAccountBalance">fetchIrisAccountBalance</a></li><li><a href="global.html#fetchIrisAddressDelegationHistory">fetchIrisAddressDelegationHistory</a></li><li><a href="global.html#fetchIrisAddressDelegations">fetchIrisAddressDelegations</a></li><li><a href="global.html#fetchIrisAddressUnbondingDelegations">fetchIrisAddressUnbondingDelegations</a></li><li><a href="global.html#fetchIrisDelegateValidatorRewards">fetchIrisDelegateValidatorRewards</a></li><li><a href="global.html#fetchIrisGovernanceProposals">fetchIrisGovernanceProposals</a></li><li><a href="global.html#fetchIrisGovProposalVotesByProposalId">fetchIrisGovProposalVotesByProposalId</a></li><li><a href="global.html#fetchIrisLatestBlock">fetchIrisLatestBlock</a></li><li><a href="global.html#fetchIrisNodeInfo">fetchIrisNodeInfo</a></li><li><a href="global.html#fetchIrisStakingParameters">fetchIrisStakingParameters</a></li><li><a href="global.html#fetchIrisTxByHash">fetchIrisTxByHash</a></li><li><a href="global.html#fetchIrisValidatorCandidates">fetchIrisValidatorCandidates</a></li><li><a href="global.html#fetchKavaAccountAuthInfo">fetchKavaAccountAuthInfo</a></li><li><a href="global.html#fetchKavaAccountBalance">fetchKavaAccountBalance</a></li><li><a href="global.html#fetchKavaAddressDelegations">fetchKavaAddressDelegations</a></li><li><a href="global.html#fetchKavaAddressDelegationTxHistory">fetchKavaAddressDelegationTxHistory</a></li><li><a href="global.html#fetchKavaAddressUnbondingDelegations">fetchKavaAddressUnbondingDelegations</a></li><li><a href="global.html#fetchKavaDelegateValidatorRewards">fetchKavaDelegateValidatorRewards</a></li><li><a href="global.html#fetchKavaDelegationRewards">fetchKavaDelegationRewards</a></li><li><a href="global.html#fetchKavaDelegationUnbondingTxs">fetchKavaDelegationUnbondingTxs</a></li><li><a href="global.html#fetchKavaGovernanceProposals">fetchKavaGovernanceProposals</a></li><li><a href="global.html#fetchKavaGovProposalVotesByProposalId">fetchKavaGovProposalVotesByProposalId</a></li><li><a href="global.html#fetchKavaLatestBlock">fetchKavaLatestBlock</a></li><li><a href="global.html#fetchKavaStakingParameters">fetchKavaStakingParameters</a></li><li><a href="global.html#fetchKavaTxByHash">fetchKavaTxByHash</a></li><li><a href="global.html#fetchKavaValidatorSet">fetchKavaValidatorSet</a></li><li><a href="global.html#fetchTerraAccountAuthInfo">fetchTerraAccountAuthInfo</a></li><li><a href="global.html#fetchTerraAccountBalance">fetchTerraAccountBalance</a></li><li><a href="global.html#fetchTerraAddressDelegations">fetchTerraAddressDelegations</a></li><li><a href="global.html#fetchTerraAddressDelegationTxHistory">fetchTerraAddressDelegationTxHistory</a></li><li><a href="global.html#fetchTerraAddressUnbondingDelegations">fetchTerraAddressUnbondingDelegations</a></li><li><a href="global.html#fetchTerraDelegateValidatorRewards">fetchTerraDelegateValidatorRewards</a></li><li><a href="global.html#fetchTerraDelegationRewards">fetchTerraDelegationRewards</a></li><li><a href="global.html#fetchTerraDelegationUnbondingTxs">fetchTerraDelegationUnbondingTxs</a></li><li><a href="global.html#fetchTerraGovernanceProposals">fetchTerraGovernanceProposals</a></li><li><a href="global.html#fetchTerraGovProposalVotesByProposalId">fetchTerraGovProposalVotesByProposalId</a></li><li><a href="global.html#fetchTerraLatestBlock">fetchTerraLatestBlock</a></li><li><a href="global.html#fetchTerraStakingParameters">fetchTerraStakingParameters</a></li><li><a href="global.html#fetchTerraTxByHash">fetchTerraTxByHash</a></li><li><a href="global.html#fetchTerraValidatorSet">fetchTerraValidatorSet</a></li><li><a href="global.html#getCosmosAddressFromPubkey">getCosmosAddressFromPubkey</a></li><li><a href="global.html#getIrisAddressFromPubkey">getIrisAddressFromPubkey</a></li><li><a href="global.html#getLedgerCosmosVersion">getLedgerCosmosVersion</a></li><li><a href="global.html#getLedgerPubKey">getLedgerPubKey</a></li><li><a href="global.html#govDeposit">govDeposit</a></li><li><a href="global.html#govVote">govVote</a></li><li><a href="global.html#pollLedgerDevice">pollLedgerDevice</a></li><li><a href="global.html#postSignedTx">postSignedTx</a></li><li><a href="global.html#processCosmosGovernanceProposals">processCosmosGovernanceProposals</a></li><li><a href="global.html#processIrisGovernanceProposals">processIrisGovernanceProposals</a></li><li><a href="global.html#queryCosmosProposals">queryCosmosProposals</a></li><li><a href="global.html#queryIrisProposals">queryIrisProposals</a></li><li><a href="global.html#requestWrapper">requestWrapper</a></li><li><a href="global.html#SET_COSMOS_ACCOUNT">SET_COSMOS_ACCOUNT</a></li><li><a href="global.html#SET_COSMOS_ADDRESS">SET_COSMOS_ADDRESS</a></li><li><a href="global.html#SET_COSMOS_PROPOSALS">SET_COSMOS_PROPOSALS</a></li><li><a href="global.html#SET_IRIS_ACCOUNT">SET_IRIS_ACCOUNT</a></li><li><a href="global.html#SET_IRIS_ADDRESS">SET_IRIS_ADDRESS</a></li><li><a href="global.html#SET_IRIS_PROPOSALS">SET_IRIS_PROPOSALS</a></li><li><a href="global.html#SET_KAVA_ACCOUNT">SET_KAVA_ACCOUNT</a></li><li><a href="global.html#SET_KAVA_ADDRESS">SET_KAVA_ADDRESS</a></li><li><a href="global.html#SET_TERRA_ACCOUNT">SET_TERRA_ACCOUNT</a></li><li><a href="global.html#SET_TERRA_ADDRESS">SET_TERRA_ADDRESS</a></li><li><a href="global.html#SET_VOTE_PROPOSAL">SET_VOTE_PROPOSAL</a></li><li><a href="global.html#signMsg">signMsg</a></li><li><a href="global.html#withdrawAllRewards">withdrawAllRewards</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Mon Mar 02 2020 21:59:03 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
